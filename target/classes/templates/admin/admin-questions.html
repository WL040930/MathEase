<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/container.css}">
    <link rel="stylesheet" th:href="@{/css/admin_question.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>

<section class="content-header" th:replace="menu/menu-admin::IncludeMenu"></section>

<div class="container">
    <!-- Left Panel: Topics -->
    <div class="left-panel">
        <div th:each="topic : ${topics}" class="clickable-topic" th:data-topic-id="${topic.topicId}">
            <div style="float: left; width: 30%">
                <img th:src="@{${topic.picturePath}}" alt="topic image" class="topic-image">
            </div>
            <div style="float: right; width: 65%;">
                <div class="topic-info-container">
                    <span th:text="'Chapter ' + ${topic.topicId}"></span><br>
                    <span th:text="${topic.topicName}"></span>
                </div>
            </div>
            <div style="clear: both"></div>
        </div>
    </div>

    <!-- Right Panel: Topic Information -->
    <div class="right-panel" id="topicInfoPanel">
        <p>Select a topic to view details...</p>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", async function() {
        const topicList = document.querySelectorAll('.clickable-topic');
        const topicInfoPanel = document.getElementById('topicInfoPanel');

        topicList.forEach(topic => {
            topic.addEventListener('click', async () => {
                // Remove 'active' class from all topics initially
                topicList.forEach(t => t.classList.remove('active'));

                // Add 'active' class to the clicked topic
                topic.classList.add('active');

                const topicId = topic.dataset.topicId;

                try {
                    const topicResponse = await fetch(`/api/topics/${topicId}`);
                    if (!topicResponse.ok) {
                        throw new Error('Failed to fetch topic details');
                    }
                    const topicDetails = await topicResponse.json();

                    const questionResponse = await fetch(`/api/questions/${topicId}`);
                    if (!questionResponse.ok) {
                        throw new Error('Failed to fetch questions');
                    }
                    const questions = await questionResponse.json();

                    topicInfoPanel.innerHTML = generateTopicInfoHTML(topicDetails, questions);
                } catch (error) {
                    console.error('Error fetching data:', error);
                }
            });
        });

        function generateTopicInfoHTML(topicDetails, questions) {
            const hasQuestions = questions && questions.length > 0;

            if (!hasQuestions) {
                return `
                <div class="topic-info">
                    <div class="top-panel">
                        <div style="float: left; width: 20%">
                            <img src="${topicDetails.picturePath}" alt="topic image" class="topicTop">
                        </div>
                        <div style="float: right; width: 79%">
                            <h2>Chapter ${topicDetails.topicId}</h2>
                            <p>Topic Name: ${topicDetails.topicName}</p>
                        </div>
                        <div style="clear: both"></div>
                    </div>
                    <div class="table-panel">
                        <p>No questions for this chapter.</p>
                    </div>
                    <div class="controller">
                        <button class="control-button add-button">Add</button>
                        <button class="control-button edit-button">Edit</button>
                        <button class="control-button delete-button">Delete</button>
                    </div>
                </div>
            `;
            }

            let questionsHTML = `
            <h3>Questions:</h3>
            <table>
                <thead>
                    <tr>
                        <th>Question ID</th>
                        <th>Question Text</th>
                    </tr>
                </thead>
                <tbody>
                    ${questions.map(question => `
                        <tr>
                            <td>${question.questionId}</td>
                            <td>${question.question}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;

            return `
            <div class="topic-info">
                <div class="top-panel">
                    <div style="float: left; width: 20%">
                        <img src="${topicDetails.picturePath}" alt="topic image" class="topicTop">
                    </div>
                    <div style="float: right; width: 79%">
                        <h2>Chapter ${topicDetails.topicId}</h2>
                        <p>Topic Name: ${topicDetails.topicName}</p>
                    </div>
                    <div style="clear: both"></div>
                </div>
                <div class="table-panel">
                    ${questionsHTML}
                </div>
                <div class="controller">
                    <button class="control-button add-button">Add</button>
                    <button class="control-button edit-button">Edit</button>
                    <button class="control-button delete-button">Delete</button>
                </div>
            </div>
        `;
        }
    });
</script>

</body>
</html>
